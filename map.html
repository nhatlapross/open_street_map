
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin="">
    </script>
    <style>
        #map { height: 600px; }
    </style>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<body data-rsssl=1>
    <h1>BẢN ĐỒ HÀNH CHÍNH QUẬN 10</h1>
    <div id="map"></div>
    <div id="output"></div>
     <!-- Modal -->
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
        
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Modal Header</h4>
                </div>
                <div class="modal-body">
                    <img id="my_image" class="img-thumbnail">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        
        </div>
    </div>
    <script>
        var map = L.map('map');
        map.setView([10.7703, 106.6778], 14);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);


        const options = {
            enableHighAccuracy: true, 
            // Get high accuracy reading, if available (default false)
            timeout: 5000, 
            // Time to return a position successfully before error (default infinity)
            maximumAge: 2000, 
            // Milliseconds for which it is acceptable to use cached position (default 0)
        };

        navigator.geolocation.watchPosition(success, error, options);
        // Fires success function immediately and when user position changes

        let marker, circle, zoomed;
        var mapPlace = {
            "Phường 1":[[10.7651,106.6776],"https://nasaland.vn/wp-content/uploads/2022/09/Quan-10-1.jpg"],
            "Phường 2": [[10.7630,106.6737],"https://nasaland.vn/wp-content/uploads/2022/09/Quan-10-2.jpg"],
            "Phường 4": [[10.76312,106.66966],"https://nasaland.vn/wp-content/uploads/2022/09/Quan-10-3.jpg"],
            "Phường 5": [[10.76128,106.66683],"https://nasaland.vn/wp-content/uploads/2022/09/Quan-10-1.jpg"],
            "Phường 6": [[10.7617,106.6638],"https://nasaland.vn/wp-content/uploads/2022/09/Quan-10-2.jpg"],
            "Phường 7": [[10.76130,106.66156],"https://nasaland.vn/wp-content/uploads/2022/09/Quan-10-3.jpg"],
            "Phường 8": [[10.76501,106.66613],"https://nasaland.vn/wp-content/uploads/2022/09/Quan-10-1.jpg"],
            "Phường 9": [[10.76643,106.67071],"https://nasaland.vn/wp-content/uploads/2022/09/Quan-10-3.jpg"],
            "Phường 10": [[10.76901,106.67283],"https://nasaland.vn/wp-content/uploads/2022/09/Quan-10-3.jpg"],
            "Phường 11": [[10.7732,106.6785],"https://nasaland.vn/wp-content/uploads/2022/09/Quan-10-1.jpg"],
            "Phường 12": [[10.7744,106.6725],"https://nasaland.vn/wp-content/uploads/2022/09/Quan-10-2.jpg"],
            "Phường 13": [[10.7792,106.6707],"https://nasaland.vn/wp-content/uploads/2022/09/Quan-10-1.jpg"],
            "Phường 14": [[10.7729,106.6616],"https://nasaland.vn/wp-content/uploads/2022/09/Quan-10-2.jpg"],
            "Phường 15": [[10.7817,106.6661],"https://nasaland.vn/wp-content/uploads/2022/09/Quan-10-1.jpg"],
        };
        var popup = L.popup();

        function success(pos) {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;
            const accuracy = pos.coords.accuracy; // Accuracy in metres

            // marker = L.marker([lat,lng]).addTo(map);
            // circle = L.circle([lat,lng],{radius:accuracy}).addTo(map);

            Object.keys(mapPlace).forEach(key=>{
                marker = L.marker(mapPlace[key][0]).addTo(map);
                marker.bindPopup(key);
                marker.setPopupContent("<h6>"+key+"<h6><img src='"+mapPlace[key][1]+"' alt='quan 10' width='60' height='60' data-toggle='modal' data-target='#myModal' data-whatever='"+key+"' onclick='openModal(`"+key+"`)'> ");
                L.circle(mapPlace[key][0],{radius:accuracy}).addTo(map);
                // L.popup()
                // .setLatLng(mapPlace[key])
                // .setContent(key)
                // .addTo(map);
            })

            // if(!zoomed)
            // {
            //     map.fitBounds(circle.getBounds());
            // }
            
            //map.setView([lat,lng]);
            map.setView([10.7703, 106.6778], 14);
            

            // document.getElementById('output').innerText = `
            // User coordinates: 
            // Latitude ${lat}.
            // Longitude ${lng}.
            // Estimation accurate within ${Math.round(accuracy)} metres.`;
        }

        // function onMapClick(e) {
        //     popup
        //     .setLatLng(e.latlng)
        //     .setContent("You clicked the map at " + e.latlng.toString())
        //     .openOn(map);
        // }
        // map.on('click', onMapClick);

        function openModal(event){
            console.log("hello"+event);
            //modal.style.display = "block";

        }
      

        function error(err) {
            if (err.code === 1) {
                alert("Please allow geolocation access");
                // Runs if user refuses access
            } else {
                alert("Cannot get current location");
                // Runs if there was a technical problem.
            }
        }

        $('#myModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget)
            var recipient = button.data('whatever') // Extract info from data-* attributes
            // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
            // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
            var modal = $(this)
            modal.find('.modal-title').text('Đây là ' + recipient)
            //console.log(mapPlace[recipient][1]);
            $('#my_image').attr('src',mapPlace[recipient][1]);
        })
    </script>
  
</body>
</html>